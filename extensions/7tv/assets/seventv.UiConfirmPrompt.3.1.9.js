import{f as T,ad as f,w as S,n as g,a as A,e as D,r as E,x as B,l as _,m as U,G as b,q as F,D as N,an as P,F as $,E as q,_ as V}from"./seventv.index.3.1.9.js";import{u as I,h as k,m as O}from"./seventv.GearsIcon.3.1.9.js";import{f as j}from"./seventv.index.3.1.92.js";const L=new WeakMap;function G(h,t){let r=L.get(h);r||(r=T({userInput:0,init:!1,sys:!0,live:!1,visible:!0,paused:!1,pauseBuffer:[],scrollClear:()=>{},container:void 0,bounds:void 0}),L.set(h,r));const s=f(r,"container"),o=f(r,"bounds");t&&S(()=>{var e,n;(e=t.scroller.value)!=null&&e.container&&(s.value=t.scroller.value.container),t.bounds.value&&(o.value=t.bounds.value),(n=t.scroller.value)!=null&&n.isActive&&r.userInput++});async function c(e=0){if(!s.value||!(o!=null&&o.value)||r.paused)return;if(r.scrollClear(),r.sys=!0,e===0){s.value.scrollTo({top:s.value.scrollHeight}),o.value=s.value.getBoundingClientRect();return}const n=await new Promise(l=>{g(()=>{if(!s.value)return 0;l(s.value.scrollTop)})}),a=Date.now();let i=!1;function u(){if(!s.value||!(o!=null&&o.value)||r.paused||i)return;const l=Date.now(),p=Math.min(1,(l-a)/e);s.value.scrollTop=p*(s.value.scrollHeight-n)+n,p<1?requestAnimationFrame(u):o.value=s.value.getBoundingClientRect()}r.scrollClear=()=>i=!0,e<1?(s.value.scrollTo({top:s.value.scrollHeight}),o.value=s.value.getBoundingClientRect()):requestAnimationFrame(u)}function v(){r.paused=!0}async function d(){r.paused=!1,r.init=!0,g(()=>{r.init=!1,c()})}async function y(){const{top:e,h:n}=await new Promise(i=>{g(()=>{if(!s.value||!(o!=null&&o.value))return{top:0,h:0};const u=Math.floor(s.value.scrollTop),l=Math.floor(s.value.scrollHeight-o.value.height);i({top:u,h:l})})}),a=r.live=e>=n-1;if(!r.init){if(r.sys){r.sys=!1;return}r.userInput>0&&(r.userInput=0,v()),a&&d()}}function C(e){e.deltaY<0&&r.userInput++}return T({init:f(r,"init"),paused:f(r,"paused"),live:f(r,"live"),pauseBuffer:f(r,"pauseBuffer"),scrollToLive:c,pause:v,unpause:d,onScroll:y,onWheel:C})}const Y=I("chat.smooth_scroll_duration"),M=I("chat.line_limit",150);let m;const H=I("chat.message_batch_duration"),R=new WeakMap;function te(h){let t=R.get(h);t||(t=T({displayed:[],displayedByUser:{},awaited:new Map,buffer:[],lowTrustUsers:{},moderated:[],chatters:{},chattersByUsername:{},overflowLimit:0,twitchHandlers:new Set,sendMessage:()=>{}}),R.set(h,t),g(()=>{A(()=>r.paused,(e,n)=>{if(e&&!n)return;const a=Math.ceil(r.pauseBuffer.length/32);let i=0;for(;r.pauseBuffer.length;){const u=r.pauseBuffer.splice(0,50);i+=a,k(()=>{t.displayed=t.displayed.concat(u)},i)}k(()=>{r.scrollToLive()},i+a)})}));const r=G(h);function s(e,n){if(r.paused){r.pauseBuffer.push(e),r.pauseBuffer.length>M.value&&r.pauseBuffer.shift();return}if(e.author){e.author.lastMsgId=e.sym;const a=t.chatters[e.author.id];a?(a.username=e.author.username,a.displayName=e.author.displayName,a.color=e.author.color,a.intl=e.author.intl):t.chatters[e.author.id]=e.author,(!t.chatters[e.author.id]||!t.chattersByUsername[e.author.username])&&(t.chatters[e.author.id]=e.author,e.author.username&&(t.chattersByUsername[e.author.username]=e.author)),t.displayedByUser[e.author.username]||(t.displayedByUser[e.author.username]={}),t.displayedByUser[e.author.username][e.id]=e}t.buffer.push(e),t.awaited.has(e.id)&&(t.awaited.get(e.id)(e),t.awaited.delete(e.id)),c(n)}function o(){t.displayed.length=0,t.buffer.length=0,t.chatters={}}function c(e){m||(m=window.setTimeout(()=>{if(r.paused){m=void 0;return}if(r.init==!0&&(r.init=!1),t.buffer.length>0){const a=t.buffer.splice(0,t.buffer.length);t.displayed.push(...a)}g(()=>r.scrollToLive(Y.value));const n=M.value*1.25;t.displayed.length>n?m=window.setTimeout(()=>{const a=t.displayed.splice(0,t.displayed.length-M.value);for(const i of a){if(!i.author)continue;const u=t.displayedByUser[i.author.username];u&&delete u[i.id]}m=void 0},(e?5:H.value)/1.5):m=void 0},(e?5:H.value)/2))}function v(e,n){const a=t.displayed.length+r.pauseBuffer.length,i=t.displayed.length,u=[];for(let l=a-1;l>=0;l--){const p=l>=i?r.pauseBuffer[l-i]:t.displayed[l];if(p&&e(p)&&(u.push(p),!n))break}return n?u:u[0]??null}function d(e){const n=t.displayedByUser[e];return n?Object.values(n):[]}async function y(e,n=1e4){return new Promise((a,i)=>{const u=t.displayed.find(w=>w.id===e);if(u)return a(u);const l=t.buffer.find(w=>w.id===e);if(l)return a(l);const{stop:p}=k(()=>{t.awaited.delete(e),i(Error("Timed out waiting for message"))},n);t.awaited.set(e,w=>{a(w),p()})})}function C(){t.displayed.forEach(e=>e.refresh())}return T({displayed:f(t,"displayed"),handlers:t.twitchHandlers,chatters:f(t,"chatters"),chattersByUsername:f(t,"chattersByUsername"),lowTrustUsers:f(t,"lowTrustUsers"),moderated:f(t,"moderated"),sendMessage:f(t,"sendMessage"),find:v,messagesByUser:d,awaitMessage:y,add:s,clear:o,reload:C})}const z={key:0,class:"seventv-confirm-prompt-heading"},J={class:"seventv-confirm-prompt-body"},K={key:0},Q={class:"seventv-confirm-prompt-choice"},X=["onClick"],Z=D({__name:"UiConfirmPrompt",props:{title:{},message:{},choices:{}},emits:["answer","close"],setup(h,{emit:t}){const r=t,s=E();function o(c){r("answer",c),r("close")}return j(s,()=>{r("close")}),(c,v)=>(B(),_("main",{ref_key:"promptRef",ref:s,class:"seventv-confirm-prompt"},[c.title?(B(),_("div",z,[U("p",null,b(c.title),1),F(O,{onClick:v[0]||(v[0]=d=>r("close"))})])):N("",!0),U("div",J,[c.message?(B(),_("p",K,b(c.message),1)):P(c.$slots,"default",{key:1},void 0,!0)]),U("div",Q,[(B(!0),_($,null,q(c.choices,(d,y)=>(B(),_("button",{key:y,onClick:C=>o(d)},b(d.toUpperCase()),9,X))),128))])],512))}}),re=V(Z,[["__scopeId","data-v-8612a56d"]]);export{re as U,G as a,te as u};
