import{u as _e}from"./seventv.ReactHooks.3.1.9.js";import{g as Re,a as Be,d as Fe}from"./seventv.useModule.3.1.9.js";import{u as g,k as Ge,v as ge,x as Ue,p as ce,y as He,o as Y,i as Ve,_ as je,h as Ke,r as ze,d as B}from"./seventv.GearsIcon.3.1.9.js";import{b as Ee,a as we}from"./seventv.index.3.1.92.js";import{_ as pe,x as v,l as E,m as U,e as Q,r as O,w as Ye,B as G,C as q,q as H,F,D,E as oe,a as Oe,ag as Se,u as j,aw as J,G as Je,an as qe,ad as Qe,Y as ke,ax as Xe,ay as Ze,at as be,f as et}from"./seventv.index.3.1.9.js";import{i as tt}from"./seventv.Transform.3.1.9.js";import{g as Ce}from"./seventv.Input.3.1.9.js";import{u as ot,a as nt}from"./seventv.useChatEmotes.3.1.9.js";import{u as st,U as Me}from"./seventv.UiConfirmPrompt.3.1.9.js";import{d as at}from"./seventv.useCosmetics.3.1.9.js";import{E as ue}from"./seventv.Emote.3.1.9.js";import{U as rt}from"./seventv.UiFloating.3.1.9.js";import{a as Te}from"./seventv.useFloatContext.3.1.9.js";const it={},lt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",width:"1em",height:"1em",fill:"currentColor"},ct=U("path",{d:"M320 240L160 384 0 240l0-48 320 0 0 48z"},null,-1),ut=[ct];function pt(I,y){return v(),E("svg",lt,ut)}const xe=pe(it,[["render",pt]]),ft={class:"seventv-autocomplete-floater"},mt={key:0,class:"seventv-autocomplete-floater-list",direction:"backwards"},dt={class:"seventv-autocomplete-floater-list",direction:"current"},ht={key:1,class:"seventv-autocomplete-floater-list",direction:"forwards"},yt=Q({__name:"ChatInputCarousel",props:{instance:{},currentMatch:{},backwardsMatches:{},forwardsMatches:{}},emits:["back","forward"],setup(I,{emit:y}){const M=I,k=y,S=g("chat_input.autocomplete.carousel_arrow_keys"),T=O(null),L=O(new Set),A=O(new Set),N=O(new Set);return Ye(()=>{L.value=new Set(M.backwardsMatches),A.value=new Set(M.forwardsMatches),N.value=new Set([M.currentMatch]);const w=M.instance.domNodes.root;w&&(T.value=w)}),Ee("keydown",w=>{S.value&&(w.isComposing||(w.key==="ArrowLeft"?k("back",w):w.key==="ArrowRight"&&k("forward",w)))},{capture:!0}),(w,f)=>T.value&&w.currentMatch.item?(v(),G(rt,{key:0,anchor:T.value,placement:"top"},{default:q(()=>[U("div",ft,[L.value.size?(v(),E("div",mt,[H(xe),(v(!0),E(F,null,oe(L.value,a=>(v(),E(F,{key:a.token},[a.item?(v(),G(ue,{key:0,emote:a.item},null,8,["emote"])):D("",!0)],64))),128))])):D("",!0),U("div",dt,[(v(!0),E(F,null,oe(N.value,a=>(v(),E(F,{key:a.token},[a.item?(v(),G(ue,{key:0,emote:a.item},null,8,["emote"])):D("",!0)],64))),128))]),A.value.size?(v(),E("div",ht,[(v(!0),E(F,null,oe(A.value,a=>(v(),E(F,{key:a.token},[a.item?(v(),G(ue,{key:0,emote:a.item},null,8,["emote"])):D("",!0)],64))),128)),H(xe)])):D("",!0)])]),_:1},8,["anchor"])):D("",!0)}}),vt=pe(yt,[["__scopeId","data-v-7b505fa6"]]),V=3,_t=Q({__name:"ChatInput",props:{instance:{}},setup(I){var he;const y=I,M={OFF:0,COLON:1,ALWAYS_ON:2},k=Re("chat-input"),S=Ge(),T=ot(y.instance.component.componentRef.props.channelID,!0),L=st(T),A=nt(T),N=at(((he=S.identity)==null?void 0:he.id)??""),w=Ve(),f=g("chat_input.autocomplete.colon"),a=g("chat_input.autocomplete.colon.emoji"),b=g("chat_input.autocomplete.chatters"),X=g("chat_input.autocomplete.carousel"),ne=g("chat_input.spam.rapid_fire_send"),_=g("chat_input.autocomplete.colon.mode"),P=g("chat_input.autocomplete.carousel.mode"),$=O({}),W=O(),fe=O(""),Z=O(!1),ee=O(),se=O([]),ae=O(-1),Le=we("Control"),De=we("Shift");Ee(window,"keydown",$e,{capture:!0});function me(e,o="tab",i){const s=new Set,c=[],r=o==="tab"?P.value:_.value,l=e.toLowerCase(),u=n=>({0:n.toLowerCase().startsWith(l),1:n.toLowerCase().includes(l)})[r];for(const[n,d]of Object.entries(N.emotes))s.has(n)||!u(n)||(s.add(n),c.push({token:n,priority:1,item:d}));for(const[n,d]of Object.entries(A.providers))if(n!="EMOJI")for(const[,x]of Object.entries(d))for(const t of x.emotes){const h=t.name;s.has(h)||!u(h)||(s.add(h),c.push({token:h,priority:2,item:t}))}if(o==="colon")for(const[n]of Object.entries(A.emojis))s.has(n)||!u(n)||(s.add(n),c.push({token:n,priority:4}));if(b.value&&o==="tab"){const n=l.startsWith("@"),d=l.replace("@",""),x=Object.entries(L.chatters);for(const[,t]of x)s.has(t.displayName)||!t.displayName.toLowerCase().startsWith(d)||c.push({token:(n?"@":"")+t.displayName,priority:10})}return c.sort((n,d)=>n.priority+d.priority*(n.token.localeCompare(d.token)/.5)),typeof i=="number"&&c.length>i&&(c.length=i),c}function re(e,o){var x,t;const s=y.instance.component.componentRef,c=(x=s.state)==null?void 0:x.slateEditor;if(!c)return;const r=(t=c.selection)==null?void 0:t.anchor;if(!r)return;e&&(e.preventDefault(),e.stopImmediatePropagation());let l=c;for(const h of r.path){if(!l)break;l=l.children[h]}let u=null,n=0,d=0;if(l.type=="text"&&typeof l.text=="string"){const h=l.text,C=r.offset;[n,d]=Ce(h,C),r.offset!=n&&(u=h.substring(n,d))}if(u&&u!=" "){const h=W.value;let C,p=0,m,K=[],z=[];if(!h||h.expectedPath!=r.path||h.expectedOffset!=r.offset||h.expectedWord!=u){const R=u.endsWith(" ")?u.slice(0,-1):u;m=me(R,"tab"),C=m[p]}else m=h.matches,p=o?h.index-1:h.index+1,p%=m.length,o&&p<0&&(p=m.length-1),C=m[p];if(K=m.slice(Math.max(0,p-V),p),z=m.slice(p+1,p+V+1),z.length<V&&z.push(...m.slice(0,V-z.length).filter(R=>R!==C)),K.length<V&&K.unshift(...m.slice(K.length-V).filter(R=>R!==C)),C){const R=Ie(C.token,s.props.emotes)?C.token:`${C.token} `;Z.value=!0,c.apply({type:"remove_text",path:r.path,offset:n,text:u}),c.apply({type:"insert_text",path:r.path,offset:n,text:R});const ye=n+R.length,ve={path:r.path,offset:ye};c.apply({type:"set_selection",newProperties:{anchor:ve,focus:ve}}),W.value={index:p,matches:m,currentMatch:C,backwardsMatches:K,forwardsMatches:z,expectedOffset:ye,expectedPath:r.path,expectedWord:R}}else W.value=void 0}}function Ie(e,o){for(const i of o)for(const s of i.emotes)if(s.token==e)return!0;return!1}function Ne(){var s;const i=(s=y.instance.component.componentRef.state)==null?void 0:s.slateEditor;i&&(se.value.unshift(i.children),se.value.splice(9,1/0),de())}function ie(e=!0){var u,n,d;const s=(u=y.instance.component.componentRef.state)==null?void 0:u.slateEditor;if(!s)return!1;const c=se.value;let r=ae.value;if(e?r+=1:r-=1,r<-1||c.length<r)return!1;ee.value||(ee.value=s.children);let l;if(r<0?l=ee.value:l=c[r],l){if(Z.value=!0,e&&(((n=s.selection)==null?void 0:n.focus.offset)??0)>1)return!1;if(!e&&(((d=s.selection)==null?void 0:d.focus.offset)??0)<fe.value.length)return!1;for(const p in s.children)s.apply({type:"remove_node",path:[p],node:s.children[p]});for(const p in l)s.apply({type:"insert_node",path:[p],node:l[p]});const x=[];let t;if(l.length>0){const p=l.length-1;for(x.push(p),t=l[p];t&&t.children&&t.children.length>0;){const m=t.children.length-1;x.push(m),t=t.children[m]}}let h=0;t&&t.type=="text"&&t.text&&(h=t.text.length);const C={path:x,offset:h};return s.apply({type:"set_selection",newProperties:{anchor:C,focus:C}}),ae.value=r,!0}return!1}function de(){ae.value=-1,ee.value=void 0,W.value=void 0}function Pe(e){if(!e.isComposing)switch(e.key){case"Tab":re(e,De.value??void 0);break;case"ArrowUp":ie(!0)&&(e.preventDefault(),e.stopImmediatePropagation());break;case"ArrowDown":ie(!1)&&(e.preventDefault(),e.stopImmediatePropagation());break}}function $e(e){var o,i;if(e.key==="Enter"){const s=y.instance.component,c=s.props.tray,r=(o=s.componentRef.state)==null?void 0:o.slateEditor;if(f.value!==M.ALWAYS_ON||!c||c.type!=="autocomplete-tray"||!r||!((i=r.selection)!=null&&i.anchor))return;e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation();const l=r.selection.anchor;let u=r;for(const x of l.path){if(!u)break;u=u.children[x]}const n=u.type==="text"&&typeof u.text=="string"?Ce(u.text,l.offset)[1]:0,d={path:l.path,offset:n};r.apply({type:"set_selection",newProperties:{anchor:d,focus:d}}),r.apply({type:"insert_text",path:l.path,offset:n,text:" "})}}function We(e,o,...i){var u,n;if(f.value===M.OFF||f.value===M.COLON&&!o.startsWith(":"))return;const s=o.startsWith(":")?o.substring(1):o;if(s.length<2)return;const c=(e==null?void 0:e.call(this,`:${s}`,...i))??[];f.value===M.ALWAYS_ON&&c.map(d=>d.current=o);const r={...N.emotes,...A.active,...A.emojis},l=me(s,"colon",25);for(let d=l.length-1;d>-1;d--){const x=l[d].token,t=r[x];if(!t||!a.value&&t.provider=="EMOJI")continue;const h=((u=t==null?void 0:t.data)==null?void 0:u.host)??{url:"",files:[]},C=h.srcset??tt(h,t.provider,w.preferredFormat),p=((n=t.provider)==null?void 0:n.split("/"))??["",""];let m=(p==null?void 0:p[0])??t.provider;switch(t.scope){case"GLOBAL":m=m==null?void 0:m.concat(" Global");break;case"PERSONAL":m=m==null?void 0:m.concat(" Personal");break}c.unshift({type:"emote",current:o,element:[t.provider==="EMOJI"?{[J]:Symbol.for("react.element"),ref:null,key:`emote-icon-${t.id}`,type:"svg",props:{style:{width:"3em",height:"3em",padding:"0.5rem"},viewBox:"0 0 36 36",children:[{[J]:Symbol.for("react.element"),ref:null,key:`emote-text-${t.id}-text`,type:"use",props:{href:`#${t.id}`}}]}}:{[J]:Symbol.for("react.element"),ref:null,key:`emote-img-${t.id}`,type:"img",props:{style:{padding:"0.5rem"},srcset:C}},{[J]:Symbol.for("react.element"),ref:null,key:`emote-text-${t.id}`,type:"span",props:{children:`${t.name}`,style:{"margin-right":"0.25rem"}}},{[J]:Symbol.for("react.element"),ref:null,key:`emote-provider-${t.id}`,type:"span",props:{children:`(${m})`,class:[`brand-color-${p[0].toLowerCase()}`]}}],replacement:t.unicode??x})}return c.length>0?c:void 0}Oe(()=>y.instance.domNodes.root,(e,o)=>{e!==o&&(o instanceof HTMLElement&&ge(o,"ChatAutoComplete","keydown"),e instanceof HTMLElement&&Ue(e,"ChatAutoComplete","keydown",Pe,!0))},{immediate:!0}),ce(y.instance.component,"onEditableValueUpdate",function(e,o,i,...s){return i&&(Ne(),ne.value&&Le.value&&setTimeout(()=>ie(!0),0)),Z.value||de(),Z.value=!1,fe.value=o,e==null?void 0:e.call(this,o,i,...s)});const te=y.instance.component.providers.find(e=>e.autocompleteType=="mention");te&&($.value.mention=te,te.canBeTriggeredByTab=!1,He(te,"props",{value(e){L.handlers.add(e.activeChattersAPI.handleMessage)}}));const le=y.instance.component.providers.find(e=>e.autocompleteType=="emote");return le&&($.value.emote=le,ce(le,"getMatches",We)),ce(y.instance.component,"componentDidUpdate",function(...e){k!=null&&k.instance&&typeof this.props.setTray=="function"&&(k.instance.setTray=this.props.setTray,k.instance.setModifierTray=this.props.setModifierTray,k.instance.clearModifierTray=this.props.clearModifierTray);const o=e[0];return typeof o=="function"?o.call(this,...e.slice(1)):e}),Se(()=>{const e=y.instance.component;Y(e,"onEditableValueUpdate"),Y(e,"props"),e.componentRef&&Y(e.componentRef,"props");const o=y.instance.domNodes.root;o instanceof HTMLElement&&ge(o,"ChatAutoComplete","keydown");const i=$.value;i.mention&&(i.mention.canBeTriggeredByTab=!0,Y(i.mention,"props")),i.emote&&Y(i.emote,"getMatches")}),(e,o)=>W.value&&W.value.currentMatch&&j(X)?(v(),G(vt,{key:0,"current-match":W.value.currentMatch,"forwards-matches":W.value.forwardsMatches??[],"backwards-matches":W.value.backwardsMatches??[],instance:e.instance,onBack:o[0]||(o[0]=i=>re(i,!0)),onForward:o[1]||(o[1]=i=>re(i,!1))},null,8,["current-match","forwards-matches","backwards-matches","instance"])):D("",!0)}}),gt={class:"seventv-super-hint"},wt={class:"seventv-super-hint-heading"},kt={class:"seventv-super-hint-content"},bt=Q({__name:"UiSuperHint",props:{title:{}},setup(I){return(y,M)=>(v(),E("main",gt,[U("div",wt,[H(je,{provider:"7TV"}),U("span",null,Je(y.title),1)]),U("div",kt,[qe(y.$slots,"default",{},void 0,!0)])]))}}),Ae=pe(bt,[["__scopeId","data-v-7de22f02"]]),Ct=U("p",null,"Would you like 7TV to let you bypass this restriction?",-1),Mt=U("p",null,"We do a little bit of trolling, Would you like to disable the comic sans font?",-1),Tt=Q({__name:"ChatSpam",props:{instance:{},suggest:{type:Boolean}},emits:["suggest-answer"],setup(I,{emit:y}){const M=I,k=y,S=Be("chat"),T=Qe(M.instance.domNodes,"root"),L=g("chat.font-april-fools",!1),A=g("chat.font-april-fools-dismissed",!1),N=Te(T,{enabled:()=>M.suggest,placement:"top-start",middleware:[be({mainAxis:72})]}),w=O(!1),f=Te(T,{enabled:()=>!A.value&&w.value&&!L.value,placement:"top-start",middleware:[be({mainAxis:72})]});Ke(()=>{w.value=!0},1e4);const a=ze(!1,3e4);function b(_){_==="yes"&&(L.value=!0),A.value=!0}let X="";function ne(_){return typeof _=="string"&&_===X?(_=_.replace(Xe,""),a.value=!a.value,a.value&&(_+=" "+Ze)):a.value=!1,X=_,_}return Oe(S,_=>{!_||!_.instance||_.instance.messageSendMiddleware.set("handle-dupe",ne)},{immediate:!0}),Se(()=>{var _;(_=S.value)!=null&&_.instance&&S.value.instance.messageSendMiddleware.delete("handle-dupe")}),(_,P)=>(v(),E(F,null,[_.suggest&&j(N)?(v(),G(ke,{key:0,to:j(N)},[H(Ae,{title:"Suggestion"},{default:q(()=>[H(Me,{choices:["yes","no"],onAnswer:P[0]||(P[0]=$=>k("suggest-answer",$)),onClose:P[1]||(P[1]=$=>k("suggest-answer",""))},{default:q(()=>[Ct]),_:1})]),_:1})],8,["to"])):D("",!0),j(f)?(v(),G(ke,{key:1,to:j(f)},[H(Ae,{title:"April Fools"},{default:q(()=>[H(Me,{choices:["yes","no"],onAnswer:P[2]||(P[2]=$=>b($)),onClose:P[3]||(P[3]=$=>b(""))},{default:q(()=>[Mt]),_:1})]),_:1})],8,["to"])):D("",!0)],64))}}),xt=[B("chat_input.autocomplete.colon","DROPDOWN",{path:["Chat","Autocompletion"],label:"Autocompletion",hint:"Enables a list of partially matching emotes when writing a message (Setting this to 'Always on' will disable the Tab-completion Carousel)",options:[["Disabled",0],["Require the ':' prefix",1],["Always on",2]],transform(I){return I===!0?1:0},defaultValue:1}),B("chat_input.autocomplete.colon.emoji","TOGGLE",{path:["Chat","Autocompletion"],label:"Autocompletion: Emoji",disabledIf:()=>g("chat_input.autocomplete.colon").value===0,hint:"Whether or not to also include emojis in the autocompletion list (This may impact performance)",defaultValue:!1}),B("chat_input.autocomplete.colon.mode","DROPDOWN",{path:["Chat","Autocompletion"],label:"Autocompletion: Mode",disabledIf:()=>g("chat_input.autocomplete.colon").value===0,hint:"What emotes should be displayed in the autocompletion list",options:[["Must start with input",0],["Must include input",1]],defaultValue:1}),B("chat_input.autocomplete.carousel","TOGGLE",{path:["Chat","Autocompletion"],label:"Tab-completion Carousel",disabledIf:()=>g("chat_input.autocomplete.colon").value===2,hint:"Show a carousel visualization of previous and next tab-completion matches",defaultValue:!0}),B("chat_input.autocomplete.carousel_arrow_keys","TOGGLE",{path:["Chat","Autocompletion"],label:"Tab-completion Carousel: Arrow Keys",disabledIf:()=>!g("chat_input.autocomplete.carousel").value||g("chat_input.autocomplete.colon").value===2,hint:"Whether or not to allow using left/right arrow keys to navigate the tab-completion carousel",defaultValue:!0}),B("chat_input.autocomplete.carousel.mode","DROPDOWN",{path:["Chat","Autocompletion"],label:"Tab-completion: Mode",disabledIf:()=>!g("chat_input.autocomplete.carousel").value||g("chat_input.autocomplete.colon").value===2,hint:"What emotes should be displayed in the tab-completion carousel",options:[["Must start with input",0],["Must include input",1]],defaultValue:0}),B("chat_input.autocomplete.chatters","TOGGLE",{path:["Chat","Autocompletion"],label:"Autocomplete chatters",hint:"Whether or not to consider the usernames of active chatters when using tab-completion",defaultValue:!0}),B("chat_input.spam.bypass_duplicate","TOGGLE",{path:["Chat","Typing"],label:"Bypass Duplicate Message Check",hint:"If enabled, you will be able to send the same message multiple times in a row",defaultValue:!1}),B("chat_input.spam.rapid_fire_send","TOGGLE",{path:["Chat","Typing"],label:"Quick Send",hint:"If enabled, you can use the Ctrl+Enter shortcut to keep the current message in the input box after sending",defaultValue:!0})],At=Q({__name:"ChatInputModule",setup(I,{expose:y}){const{markAsReady:M}=Fe("chat-input",{name:"Chat Input",depends_on:[]}),k=et(new WeakMap),S=g("chat_input.spam.bypass_duplicate"),T=O(null),L=_e({parentSelector:".chat-input__textarea",maxDepth:50,predicate:f=>f.providers},{trackRoot:!0,containerClass:"seventv-chat-input-textarea",hooks:{update(f){var a,b;k.set(f,!!((b=(a=f.component.componentRef)==null?void 0:a.props)!=null&&b.channelID))}}}),A=[{key:"message-throughput",stateKey:""},{key:"duplicated-messages",stateKey:"lastSentMessage"}];for(const f of A)_e({parentSelector:".chat-input",maxDepth:20,predicate:a=>{var b;return((b=a.props)==null?void 0:b.setModifierTray)&&a.key===f.key}},{hooks:{update(a){switch(a.component.key){case"duplicated-messages":N(a.component);break}S.value&&(f.stateKey&&(a.component.state[f.stateKey]=null),a.component.props.setModifierTray=()=>{})}}});function N(f){if(!(S.value||T.value===!1)){if(!f.props.tray||f.props.tray.type!=="duplicated-message-error"){T.value=null;return}T.value=!0}}function w(f){if(f)switch(T.value=!1,f){case"yes":S.value=!0;break;case"no":S.value=!1;break}}return y({component:L,setTray:null,setModifierTray:null,clearModifierTray:null}),M(),(f,a)=>(v(!0),E(F,null,oe(j(L).instances,b=>(v(),E(F,{key:b.identifier},[k.get(b)?(v(),G(_t,{key:0,instance:b},null,8,["instance"])):D("",!0),k.get(b)?(v(),G(Tt,{key:1,instance:b,suggest:T.value||!1,onSuggestAnswer:w},null,8,["instance","suggest"])):D("",!0)],64))),128))}}),Gt=Object.freeze(Object.defineProperty({__proto__:null,config:xt,default:At},Symbol.toStringTag,{value:"Module"}));export{Gt as _};
