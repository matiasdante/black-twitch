import{_ as Q,b as $,k as z,B as D,c as I}from"./seventv.GearsIcon.3.1.9.js";import{C as M}from"./seventv.ChatMessage.3.1.9.js";import{u as j,a as H}from"./seventv.useChatEmotes.3.1.9.js";import{u as G}from"./seventv.UiConfirmPrompt.3.1.9.js";import{a as K}from"./seventv.useCosmetics.3.1.9.js";import{E as A}from"./seventv.Emote.3.1.9.js";import{l as Z}from"./seventv.UserTag.3.1.9.js";import{e as P,x as l,l as p,m as r,q as L,O as J,u as F,G as g,D as h,F as O,E as N,Q as X,R as Y,_ as ee,ad as te,ag as se,r as oe}from"./seventv.index.3.1.9.js";import{v as V}from"./seventv.v4.3.1.9.js";const W=E=>(X("data-v-2477b017"),E=E(),Y(),E),ne={class:"seventv-emote-set-update-message-container"},ae={class:"container-header"},ie={class:"seventv-logo"},re={key:0,class:"seventv-author"},de={class:"container-body"},ce={key:0,class:"change-row"},me=W(()=>r("span",null,"switched the active emote set from ",-1)),le=W(()=>r("span",null," to ",-1)),pe={class:"change-emote"},ue={class:"change-content"},_e=["title"],ve={key:0,class:"emote-owner"},he={key:0,class:"change-action",type:"add"},fe={class:"change-emote"},ge={class:"change-content"},ye=["title"],we={key:0,class:"emote-owner"},ke={key:0,class:"change-action",type:"remove"},Ee={class:"change-emote"},Ue={class:"change-content"},Ce=["title"],Se=["title"],Le={key:0,class:"change-action",type:"update"},Te=P({__name:"EmoteSetUpdateMessage",props:{appUser:{},add:{},remove:{},update:{},wholeSet:{}},setup(E){var U,n;const a=E,f=j(),{chatters:T}=G(f);let k="Emote Set Update",s="currentColor";const y=[a.add,a.remove,a.update].filter(t=>t.length>0).length>1;(!a.wholeSet||y)&&(a.add.length>0?(k="Added Emote",s="var(--seventv-accent)"):a.remove.length>0?(k="Removed Emote",s="var(--seventv-warning)"):a.update.length>0&&(k="Renamed Emote",s="var(--seventv-info)"));const c=(U=a.appUser.connections)==null?void 0:U.find(t=>t.platform==="TWITCH"),B=(c?T[c.id]:null)??{id:(c==null?void 0:c.id)??a.appUser.id,displayName:(c==null?void 0:c.display_name)??a.appUser.display_name,username:(c==null?void 0:c.username)??a.appUser.username,color:(n=a.appUser.style)!=null&&n.color?K(a.appUser.style.color):"inherit"};return(t,o)=>(l(),p("span",ne,[r("div",ae,[r("span",ie,[L(Q,{provider:"7TV"})]),r("span",{class:"seventv-message-title",style:J({color:F(s)})},g(F(k)),5),t.appUser?(l(),p("span",re,[L(Z,{user:F(B)},null,8,["user"])])):h("",!0)]),r("div",de,[t.wholeSet&&t.wholeSet.length===2?(l(),p("div",ce,[me,r("strong",null,g(t.wholeSet[0].name),1),le,r("strong",null,g(t.wholeSet[1].name),1)])):h("",!0),t.add.length?(l(!0),p(O,{key:1},N(t.add,e=>{var d;return l(),p("div",{key:e.id,class:"change-row"},[r("span",pe,[L(A,{emote:e},null,8,["emote"])]),r("div",ue,[r("p",{class:"emote-name",title:e.name},g(e.name),9,_e),(d=e.data)!=null&&d.owner?(l(),p("p",ve,"By: "+g(e.data.owner.display_name),1)):h("",!0)]),y?(l(),p("span",he," Added ")):h("",!0)])}),128)):h("",!0),t.remove.length?(l(!0),p(O,{key:2},N(t.remove,e=>{var d;return l(),p("div",{key:e.id,class:"change-row"},[r("span",fe,[L(A,{emote:e},null,8,["emote"])]),r("div",ge,[r("p",{class:"emote-name",title:e.name},g(e.name),9,ye),(d=e.data)!=null&&d.owner?(l(),p("p",we,"By: "+g(e.data.owner.display_name),1)):h("",!0)]),y?(l(),p("span",ke," Removed ")):h("",!0)])}),128)):h("",!0),t.update.length?(l(!0),p(O,{key:3},N(t.update,([e,d])=>(l(),p("div",{key:e.id,class:"change-row"},[r("span",Ee,[L(A,{emote:d},null,8,["emote"])]),r("div",Ue,[r("p",{class:"emote-name",title:d.name},g(d.name),9,Ce),r("p",{class:"emote-owner",title:e.name},"From: "+g(e.name),9,Se)]),y?(l(),p("span",Le," Rename ")):h("",!0)]))),128)):h("",!0)])]))}}),q=ee(Te,[["__scopeId","data-v-2477b017"]]),Me=P({__name:"ChatData",setup(E){const{target:a}=$(),f=j(),T=te(f,"id"),k=G(f),s=H(f),{providers:b}=z(),y=D(()=>I.channels.where("id").equals(f.id).first().then(n=>(n==null?void 0:n.set_ids)??[]),void 0,{reactives:[T]});D(()=>I.emoteSets.where("id").anyOf(y.value??[]).or("scope").equals("GLOBAL").sortBy("priority"),n=>{if(s.providers["7TV"]={},s.providers.FFZ={},s.providers.BTTV={},!n)return;for(const o of n){if(!o.provider||!b.has(o.provider))continue;const e=o.provider??"UNKNOWN";s.providers[e]||(s.providers[e]={}),s.providers[e][o.id]=o,s.sets[o.id]=o}const t={};for(const o of n.flatMap(e=>e.emotes)){if(!o)return;t[o.name]=o}for(const o in s.emojis){const e=s.emojis[o];!e||!e.unicode||(t[e.unicode]=e)}for(const o in t)s.active[o]=t[o]},{reactives:[y]});function c(n){var S;const{id:t,emotes_added:o,emotes_removed:e,emotes_updated:d,user:R}=n.detail;if(!((S=y.value)!=null&&S.includes(t)))return;const v=s.sets[t];for(const i of o)s.active[i.name]=i,s.sets[t]&&v.emotes.push(i);for(const[i,m]of d){if(!m||!i)continue;const w=s.find(_=>_.id===m.id,!0);if(!w)continue;const u=oe(w);for(const _ in m)_!=="data"&&(u.value={...u.value,[_]:m[_]});if(delete s.active[i.name],s.active[m.name]=u.value,s.sets[t]){const _=v.emotes.findIndex(x=>x.id===m.id);_!==-1&&v.emotes.splice(_,1,u.value)}}for(let i=0;i<e.length;i++){const m=e[i],w=s.find(u=>u.id===m.id,!0);if(!(!w||w.id!==m.id)){if(e[i].data=w.data,e[i].name=w.name,delete s.active[w.name],s.sets[t]){const u=v.emotes.findIndex(_=>_.id===m.id);u!==-1&&v.emotes.splice(u,1)}if(s.sets[t]){const u=v.emotes.findIndex(_=>_.id===m.id);u!==-1&&v.emotes.splice(u,1)}}}const C=new M(V());C.setComponent(q,{appUser:R,add:o,remove:e,update:d}),k.add(C)}function B(n,t,o,e){var C,S;if(!t||!f.user)return;const d=(C=f.user.connections)==null?void 0:C[n];if(!d||d.emote_set&&d.emote_set.id!==t.id)return;const R=((S=s.sets[t.id])==null?void 0:S.emotes)??[];for(const i of R)delete s.active[i.name];delete s.sets[t.id],d.emote_set=o,I.channels.where("id").equals(f.id??"").modify(i=>{const m=i.set_ids.indexOf(t.id);m!==-1?i.set_ids.splice(m,1,o.id):i.set_ids.push(o.id)});const v=new M(V());v.setComponent(q,{appUser:e,add:[],remove:[],update:[],wholeSet:[t,o]}),k.add(v)}function U(n){s.providers.PLATFORM||(s.providers.PLATFORM={}),s.providers.PLATFORM[n.detail.id]=n.detail}return a.addEventListener("emote_set_updated",c),a.addEventListener("user_updated",n=>{const{id:t,actor:o,emote_set:e}=n.detail;!t||!e||B(e.connection_index,e.old_set,e.new_set,o)}),a.addEventListener("twitch_emote_set_data",U),se(()=>{a.removeEventListener("emote_set_updated",c),a.removeEventListener("twitch_emote_set_data",U)}),(n,t)=>null}});export{Me as _,q as a};
