import{u as U}from"./seventv.ReactHooks.3.1.9.js";import{a as x,d as j}from"./seventv.useModule.3.1.9.js";import{u as h,_ as V,p as q,y as A,o as R,l as z,d as N}from"./seventv.GearsIcon.3.1.9.js";import{e as B,r as _,a as P,x as p,l as g,m as b,q as y,u as C,D as k,Q as G,R as W,_ as O,J,w as K,ag as Q,B as I,t as Y,K as X,Y as Z,F as w,n as ee,f as te,E as ne}from"./seventv.index.3.1.9.js";import{u as oe,a as ae}from"./seventv.useChatEmotes.3.1.9.js";import{u as se}from"./seventv.useUpdater.3.1.9.js";import{u as $,E as ue}from"./seventv.EmoteMenu.3.1.9.js";import{u as re}from"./seventv.Settings.3.1.9.js";import{d as ce}from"./seventv.Async.3.1.9.js";const ie=d=>(G("data-v-7189c19d"),d=d(),W(),d),le=ie(()=>b("span",{class:"tooltip-over"},"Emote Menu",-1)),me={key:0,class:"seventv-emote-menu-update-flair"},pe=B({__name:"EmoteMenuButton",props:{onClick:{type:Function}},setup(d){const a=$(),c=se(),i=_(!1),n=h("ui.emote_menu.button_placement");return P(n,l=>{i.value=l==="below"},{immediate:!0}),(l,f)=>i.value?(p(),g("div",{key:0,class:"seventv-tw-button seventv-emote-menu-button",onClick:f[0]||(f[0]=(...o)=>l.onClick&&l.onClick(...o))},[b("button",null,[y(V,{provider:"7TV",class:"icon"})]),le,!C(c).isUpToDate&&!C(a).open?(p(),g("div",me)):k("",!0)])):k("",!0)}}),T=O(pe,[["__scopeId","data-v-7189c19d"]]),de={class:"seventv-emote-menu-wrap"},fe=B({__name:"EmoteMenu",props:{instance:{},buttonEl:{}},setup(d){const a=d,c=_(),i=_(),n=$(),l=oe(void 0,!0),f=re(),o=ae(l),u=_(),r=h("ui.emote_menu_search"),m=h("ui.emote_menu.usage"),v=x("chat"),F=h("ui.emote_menu.button_placement"),S=x("chat-input-controller");J(()=>{var e;(e=S.value)!=null&&e.instance&&S.value.instance.addButton("emote-menu",T,{onClick:()=>n.open=!n.open},1)});function E(e){const t=a.instance.component;if(e){t.onEmotePickerButtonClick();return}n.open?t.props.closeEmotePicker():(t.props.clearMenus(),typeof t.closeBitsCard=="function"&&t.closeBitsCard(),typeof t.closePaidPinnedChatCardForEmotePicker=="function"&&t.closePaidPinnedChatCardForEmotePicker(),typeof t.closeCheerCard=="function"&&t.closeCheerCard()),n.open=!n.open,ee(()=>{u.value&&u.value.focus()})}function D(e){const t=e.split(" ");for(const s of t){const M=o.active[s];M&&m.value.set(M.id,(m.value.get(M.id)??0)+1)}return m.value=new Map(m.value),e}P(v,e=>{!e||!e.instance||e.instance.messageSendMiddleware.set("emote-menu-usage",D)},{immediate:!0});function H(e){const t=a.instance.component.autocompleteInputRef;if(!t)return z.warn("ref to input not found, cannot insert emote");let s=t.getValue();r.value?s=s.slice(0,n.filter.length?n.filter.length*-1:1/0):s=s.at(-1)===" "?s:s+" ",t.setValue(s+(e.unicode??e.name)+" "),a.instance.component.chatInputRef.focus()}q(a.instance.component,"onBitsIconClick",function(e){e==null||e(),n.open=!1}),A(a.instance.component.autocompleteInputRef,"state",{value(e){if(!n.open){n.filter="";return}r.value&&(n.filter=e.value.split(" ").at(-1)??"")}});function L(e){f.open||!(e.target instanceof Node)||i.value&&i.value.contains(e.target)||a.buttonEl&&a.buttonEl.contains(e.target)||(n.open=!1)}return K(()=>{if(!c.value&&a.instance.domNodes.root){const e=a.instance.domNodes.root.querySelector(".chat-input");if(!e)return;const t=e.querySelector("[data-test-selector='chat-input']")??e;c.value=e,i.value=t}}),Q(()=>{R(a.instance.component.autocompleteInputRef,"state"),R(a.instance.component,"onBitsIconClick")}),(e,t)=>(p(),g(w,null,[b("div",de,[c.value?(p(),I(ue,{key:0,"anchor-el":c.value,width:"32.5rem",scale:"1rem",instance:a.instance,onEmoteClick:t[0]||(t[0]=s=>H(s)),onToggleNativeMenu:t[1]||(t[1]=s=>E(!0)),onClose:L},null,8,["anchor-el","instance"])):k("",!0)]),e.buttonEl&&C(F)==="regular"?(p(),I(Z,{key:0,to:e.buttonEl},[y(T,{onClick:t[2]||(t[2]=s=>E())}),b("div",{class:Y(["seventv-emote-menu-button",{"menu-open":C(n).open}]),onClick:t[3]||(t[3]=X(s=>E(),["stop"]))},[y(V,{provider:"7TV"})],2)],8,["to"])):k("",!0)],64))}}),ve=O(fe,[["__scopeId","data-v-f18218f4"]]),he=[N("ui.emote_menu_search","TOGGLE",{path:["Appearance","Interface"],label:"Emote Menu: Live Input Search",hint:"Use the chat's regular input box to search in the emote menu instead of the integrated search box",defaultValue:!1}),N("ui.emote_menu.button_placement","DROPDOWN",{path:["Appearance","Interface"],label:"Emote Menu Button Placement",hint:"Control where the 7TV emote menu button is placed. Setting to 'Below Input' will return the native emote menu to its original position.",options:[["Regular","regular"],["Below Input","below"],["Hidden","hidden"]],defaultValue:"regular"})],_e=B({__name:"EmoteMenuModule",setup(d){const{markAsReady:a}=j("emote-menu",{name:"Emote Menu",depends_on:["settings"]}),c=_(),i=te(new WeakMap),n=h("ui.emote_menu.button_placement"),l=U({parentSelector:".chat-room__content",maxDepth:150,predicate:o=>o.onEmotePickerButtonClick},{trackRoot:!0,containerClass:"seventv-chat-input-container",hooks:{render(o,u){return i.set(o,!!o.component.props.channelID),f(Object.values(o.domNodes)),u}},functionHooks:{getSendMessagePlaceholder(o){const u=this.props.activeTray;return u?u.placeholder??o.call(this):o.call(this)}}}),f=ce(o=>{for(const u of o){const r=u.querySelector("button[data-a-target='emote-picker-button']");if(r){c.value=r;for(let m=0;m<r.childElementCount;m++){const v=r.children[m];v.classList.contains("seventv-emote-menu-button")||(n.value==="regular"?v.classList.add("seventv-emote-menu-overriden"):v.classList.remove("seventv-emote-menu-overriden"))}}}},50);return P(n,()=>{for(const o of Object.values(l.instances).map(u=>u.domNodes))f(Object.values(o))},{immediate:!0}),a(),(o,u)=>(p(!0),g(w,null,ne(C(l).instances,r=>(p(),g(w,{key:r.identifier},[i.get(r)?(p(),I(ve,{key:0,instance:r,"button-el":c.value},null,8,["instance","button-el"])):k("",!0)],64))),128))}}),Be=Object.freeze(Object.defineProperty({__proto__:null,config:he,default:_e},Symbol.toStringTag,{value:"Module"}));export{Be as _};
