var M=Object.defineProperty;var w=(s,e,t)=>e in s?M(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var a=(s,e,t)=>(w(s,typeof e!="symbol"?e+"":e,t),t);import{b as O,k as S}from"./seventv.GearsIcon.3.1.9.js";import{i as g,f as o,a as T,p as k,J,ag as L,a9 as l,S as _}from"./seventv.index.3.1.9.js";const p=Symbol("seventv-channel-context"),{sendMessage:v,target:h}=O();class x{constructor(){a(this,"platform","UNKNOWN");a(this,"id","");a(this,"username","");a(this,"displayName","");a(this,"user");a(this,"loaded",!1);a(this,"setsFetched",!1);a(this,"active",!1);a(this,"count",0);a(this,"actor",{roles:new Set})}get base(){return{id:this.id,username:this.username,displayName:this.displayName,active:this.active}}setCurrentChannel(e){if(this.id===e.id)return this.username=e.username,this.displayName=e.displayName,this.active=e.active,!1;const t=this.id;return this.id=e.id,this.username=e.username,this.displayName=e.displayName,this.active=e.active,f.set(e.id,this),f.delete(t),this.fetch(),!0}leave(){this.active=!1,v("STATE",{channel:l(this.base)})}async fetch(e=!1){v("STATE",{channel:l(this.base),refetch:e}),await Promise.all([h.listenUntil("channel_fetched",t=>this.id!==t.detail.id?!1:(this.loaded=!0,this.user=t.detail.user,!0)),h.listenUntil("channel_sets_fetched",t=>(this.setsFetched=!0,this.id===t.detail.id))])}}const f=new Map;function R(s,e=!1){let t=g(p,null);if(!t){t=(s?f.get(s):null)??o(new x),s&&t.setCurrentChannel({id:s??"",username:"",displayName:"",active:!0});const i=S();T(()=>i.platform,()=>{t.platform=i.platform},{immediate:!0}),k(p,t),s&&f.set(s,t)}return e&&(J(()=>{t&&t.count++}),L(()=>{!t||!t.count||(t.count--,!(t.count>0)&&t.leave())})),t}const E=new Map,y=new Map,c=[];async function W(){if(c.length)return c;const s=g(_,""),e=await(await fetch(s+"/emoji/emoji.json")).json().catch(()=>{});for(const t of e){const i=t;i.emote={id:i.codes,name:i.name,unicode:i.char,provider:"EMOJI",flags:0},E.set(i.name,i),y.set(i.char,i)}c.push(...e)}function A(){return o({emojiList:c,emojiByCode:y,emojiByName:E})}const j=new WeakMap,d={},N={};function I(s){let e=j.get(s);e||(e=o({active:o({}),sets:o({}),emojis:o(N),providers:{"7TV":o({}),FFZ:o({}),BTTV:o({}),PLATFORM:o({}),EMOJI:o(d)}}),j.set(s,e));function t(){if(e){for(const r in e.providers)if(r!=="EMOJI")for(const n in e.providers[r])delete e.providers[r][n];for(const r in e.active)e.active[r].provider!=="EMOJI"&&delete e.active[r]}}function i(r){return e?e.providers[r]:{}}function b(r,n=!1){if(!e)return null;if(n){for(const u of Object.values(e.active))if(r(u))return u}else for(const u of Object.values(e.providers))for(const C of Object.values(u))for(const m of Object.values(C.emotes))if(r(m))return m;return null}return o({active:e.active,sets:e.sets,emojis:e.emojis,providers:e.providers,reset:t,byProvider:i,find:b})}function V(){const{emojiList:s}=A();s.forEach(e=>{d[e.group]||(d[e.group]={id:e.group,name:e.group,provider:"EMOJI",emotes:[],tags:[],immutable:!0,privileged:!0,flags:0}),d[e.group].emotes.push(e.emote),N[e.emote.name]=e.emote})}export{I as a,A as b,V as c,W as l,R as u};
