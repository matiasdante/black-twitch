var L=Object.defineProperty;var N=(e,t,s)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var M=(e,t,s)=>(N(e,typeof t!="symbol"?t+"":t,s),s);import{u as F,c as x,b as G,B as C,j as R,l as z,A as H}from"./seventv.GearsIcon.3.1.9.js";import{f as h,a as U,r as O,h as Q,ad as k}from"./seventv.index.3.1.9.js";function p(e,t,s){return Math.min(Math.max(e,s),t)}class V extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var m=V;function S(e){if(typeof e!="string")throw new m(e);if(e.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=e.trim();t=D.test(e)?K(e):e;const s=X.exec(t);if(s){const f=Array.from(s).slice(1);return[...f.slice(0,3).map(r=>parseInt(w(r,2),16)),parseInt(w(f[3]||"f",2),16)/255]}const o=Y.exec(t);if(o){const f=Array.from(o).slice(1);return[...f.slice(0,3).map(r=>parseInt(r,16)),parseInt(f[3]||"ff",16)/255]}const c=Z.exec(t);if(c){const f=Array.from(c).slice(1);return[...f.slice(0,3).map(r=>parseInt(r,10)),parseFloat(f[3]||"1")]}const d=I.exec(t);if(d){const[f,r,l,a]=Array.from(d).slice(1).map(parseFloat);if(p(0,100,r)!==r)throw new m(e);if(p(0,100,l)!==l)throw new m(e);return[...ee(f,r,l),Number.isNaN(a)?1:a]}throw new m(e)}function W(e){let t=5381,s=e.length;for(;s;)t=t*33^e.charCodeAt(--s);return(t>>>0)%2341}const T=e=>parseInt(e.replace(/_/g,""),36),J="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((e,t)=>{const s=T(t.substring(0,3)),o=T(t.substring(3)).toString(16);let c="";for(let d=0;d<6-o.length;d++)c+="0";return e[s]=`${c}${o}`,e},{});function K(e){const t=e.toLowerCase().trim(),s=J[W(t)];if(!s)throw new m(e);return`#${s}`}const w=(e,t)=>Array.from(Array(t)).map(()=>e).join(""),X=new RegExp(`^#${w("([a-f0-9])",3)}([a-f0-9])?$`,"i"),Y=new RegExp(`^#${w("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Z=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${w(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),I=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,D=/^[a-z]+$/i,B=e=>Math.round(e*255),ee=(e,t,s)=>{let o=s/100;if(t===0)return[o,o,o].map(B);const c=(e%360+360)%360/60,d=(1-Math.abs(2*o-1))*(t/100),f=d*(1-Math.abs(c%2-1));let r=0,l=0,a=0;c>=0&&c<1?(r=d,l=f):c>=1&&c<2?(r=f,l=d):c>=2&&c<3?(l=d,a=f):c>=3&&c<4?(l=f,a=d):c>=4&&c<5?(r=f,a=d):c>=5&&c<6&&(r=d,a=f);const n=o-d/2,u=r+n,_=l+n,b=a+n;return[u,_,b].map(B)};function te(e){const[t,s,o,c]=S(e).map((u,_)=>_===3?u:u/255),d=Math.max(t,s,o),f=Math.min(t,s,o),r=(d+f)/2;if(d===f)return[0,0,r,c];const l=d-f,a=r>.5?l/(2-d-f):l/(d+f);return[60*(t===d?(s-o)/l+(s<o?6:0):s===d?(o-t)/l+2:(t-s)/l+4),a,r,c]}function se(e,t,s,o){return`hsla(${(e%360).toFixed()}, ${p(0,100,t*100).toFixed()}%, ${p(0,100,s*100).toFixed()}%, ${parseFloat(p(0,1,o).toFixed(3))})`}function ne(e,t){const[s,o,c,d]=te(e);return se(s,o,c-t,d)}function P(e){if(e==="transparent")return 0;function t(d){const f=d/255;return f<=.03928?f/12.92:Math.pow((f+.055)/1.055,2.4)}const[s,o,c]=S(e);return .2126*t(s)+.7152*t(o)+.0722*t(c)}function re(e,t){const s=P(e),o=P(t);return s>o?(s+.05)/(o+.05):(o+.05)/(s+.05)}const oe={decorative:1.5,readable:3,aa:4.5,aaa:7};function q(e,t="aa",s="#fff"){return re(e,s)<oe[t]}const g=e=>{const t=e>>>24&255,s=e>>>16&255,o=e>>>8&255,c=e&255;return`rgba(${t}, ${s}, ${o}, ${(c/255).toFixed(3)})`},ae=(e,t,s,o)=>e<<24|t<<16|s<<8|o,he=(e,t)=>{const s=e>>>24&255,o=e>>>16&255,c=e>>>8&255,d=e&255;return"#"+((1<<24)+(s<<16)+(o<<8)+c).toString(16).slice(1)+(t?ie(d/255):"")},ie=e=>{if(e>1||e<0||isNaN(e))throw Error("alpha must be between 0 and 1");return Math.ceil(255*e).toString(16).toUpperCase()},pe=(e,t=1)=>{const s=parseInt((e==null?void 0:e.slice(1))??"0",16),o=s>>16&255,c=s>>8&255,d=s&255;return ae(o,c,d,255*Math.min(t,1))},$={0:{},1:{}};function ge(e,t){let s=e.toLowerCase();const o=t?"#0f0e11":"#faf9fa";if(!q(s,"aa",o))return s;const c=$[t][e];if(c)return c;const d=S(s).slice(0,3);if(t&&d.every(r=>r<36))return $[t][e]="#7a7a7a","#7a7a7a";let f=0;for(;q(s,"aa",o)&&f<50;)s=ne(s,.1*(t?-1:1)),f++;return $[t][e]=s,s}const i=h({cosmetics:{},sets:{},activeSets:new Set,entitlementBuffers:{"+":[],"-":[]},userBadges:{},userPaints:{},userEmoteSets:{},userEmoteMap:{},staticallyAssigned:{}}),E=F("vanity.paints_drop_shadows");U(E,()=>Object.values(i.cosmetics).filter(e=>e.kind==="PAINT").forEach(e=>A(e)));class j extends Map{constructor(){super(...arguments);M(this,"providers",new Set)}hasProvider(s){return this.providers.has(s)}set(s,o){return o.provider&&this.providers.add(o.provider),super.set(s,o)}delete(s){const o=this.get(s);return o?(this.providers.delete(o.provider),super.delete(s)):!1}clear(){this.providers.clear(),super.clear()}}let y=null;const ce=O(!1);x.ready().then(async()=>{const{target:e}=G();C(()=>x.cosmetics.toArray(),r=>{const l={};for(const a of r)l[a.id]||(l[a.id]=h(a),a.kind==="PAINT"&&A(a));i.cosmetics=l}),e.addEventListener("static_cosmetics_fetched",r=>{const{badges:l,paints:a}=r.detail;for(let n of l??[]){i.cosmetics[n.id]?n=i.cosmetics[n.id]:i.cosmetics[n.id]=h(n);for(const u of n.user_ids??[])!u||i.userBadges[u]&&i.userBadges[u].has(n.id)||(t({id:"",kind:"BADGE",ref_id:n.id,user_id:u,platform_id:u},"+"),i.staticallyAssigned[u]={});n.user_ids&&(n.user_ids.length=0)}for(let n of a??[]){i.cosmetics[n.id]?n=i.cosmetics[n.id]:i.cosmetics[n.id]=h(n);for(const u of n.user_ids??[])!u||i.userPaints[u]||(t({id:"",kind:"PAINT",ref_id:n.id,user_id:u,platform_id:u},"+"),i.staticallyAssigned[u]={});n.user_ids&&(n.user_ids.length=0),A(n)}},{once:!0});function t(r,l){var a,n;if(i.staticallyAssigned[r.platform_id]){for(const u of((a=i.userBadges[r.platform_id])==null?void 0:a.values())??[])u.provider==="7TV"&&i.userBadges[r.platform_id].delete(u.id);for(const u of((n=i.userPaints[r.platform_id])==null?void 0:n.values())??[])i.userPaints[r.platform_id].delete(u.id);delete i.staticallyAssigned[r.platform_id]}i.entitlementBuffers[l].push(r),s()}function s(){ce.value=!0,!y&&(y=window.setTimeout(()=>{const r=new Map(i.entitlementBuffers["+"].splice(0,i.entitlementBuffers["+"].length).map(a=>[a.id,a])),l=new Map(i.entitlementBuffers["-"].splice(0,i.entitlementBuffers["-"].length).map(a=>[a.id,a]));for(const[a,n]of l.entries()){if(r.has(a)){r.delete(a);continue}const u=c(n.kind);!u[n.platform_id]||!u[n.platform_id].has(n.ref_id)||u[n.platform_id].delete(n.ref_id)}y=window.setTimeout(async()=>{for(const a of r.values()){const n=c(a.kind);if(a.kind==="EMOTE_SET")n[a.platform_id]||(n[a.platform_id]=new Map),f(a.platform_id,a.ref_id);else{n[a.platform_id]||(n[a.platform_id]=new j);const u=n[a.platform_id];o(a.ref_id).then(_=>{u.has(a.ref_id)||u.hasProvider(_.provider)||u.set(a.ref_id,_)})}}},10),y=null},10))}function o(r){const l=i.cosmetics[r];return l?Promise.resolve(l):R(()=>i.cosmetics[r]).not.toBeUndefined()}function c(r){return{BADGE:i.userBadges,PAINT:i.userPaints,EMOTE_SET:i.userEmoteSets}[r]}function d(r,l){return new Promise(a=>{C(()=>x.emoteSets.where("id").equals(l).first(),n=>{var u;i.sets[l]=n,(u=i.userEmoteSets[r])==null||u.set(l,n),a(n)},{until:R(H(1e4)).toBeTruthy().then(()=>a(null)).then(()=>!0),count:1})})}async function f(r,l){const a=await d(r,l);if(!a){z.warn("<Cosmetics>","Emote Set could not be found",`id=${l}`);return}i.userEmoteSets[r]||(i.userEmoteSets[r]=new Map),i.userEmoteSets[r].has(l)||i.userEmoteSets[r].set(l,a),z.debug("<Cosmetics>","Assigned Emote Set to user",`id=${l}`,`userID=${r}`)}e.addEventListener("entitlement_created",r=>{t(r.detail,"+")}),e.addEventListener("entitlement_deleted",r=>{t(r.detail,"-")}),x.entitlements.toArray().then(r=>{var l,a;for(const n of r){let u=!1;const _=n.platform_id??n.user_id,b=!!i.staticallyAssigned[_];switch(n.kind){case"BADGE":if(!b&&((l=i.userBadges[_])!=null&&l.size))continue;t(n,"+"),u=!0;break;case"PAINT":if(!b&&((a=i.userPaints[_])!=null&&a.size))continue;t(n,"+"),u=!0;break;case"EMOTE_SET":f(_,n.ref_id);break}z.debug("<Cosmetics>","Assigned",r.length.toString(),"stored entitlements"),u&&(i.staticallyAssigned[n.user_id]={})}}).then(s)});function we(e){return i.userBadges[e]||(i.userBadges[e]=new j),i.userPaints[e]||(i.userPaints[e]=new j),i.userEmoteSets[e]||(i.userEmoteSets[e]=new Map),i.userEmoteMap[e]||(i.userEmoteMap[e]=Q(()=>{var s,o;const t={};for(const c of i.userEmoteSets[e].values())for(const d of c.emotes)(o=(s=d.data)==null?void 0:s.state)!=null&&o.includes("PERSONAL")&&(t[d.name]=d);return t})),h({paints:k(i.userPaints,e),badges:k(i.userBadges,e),emotes:k(i.userEmoteMap,e),emoteSets:k(i.userEmoteSets,e)})}function be(){return i}let v=null;function le(){if(v)return v;const e=document.createElement("link");e.type="text/css",e.rel="stylesheet";const t=document.createElement("style");return t.id="seventv-paint-styles",document.head.appendChild(t),v=t.sheet??null}function A(e,t=!1){var l,a;const s=le();if(!s){z.error("<Cosmetics>","Could not find paint stylesheet");return}!((l=e.data.gradients)!=null&&l.length)&&e.data.function&&(e.data.gradients||(e.data.gradients=new Array(1)),e.data.gradients[0]={function:e.data.function,canvas_repeat:"",size:[1,1],shape:e.data.shape,image_url:e.data.image_url,stops:e.data.stops??[],repeat:e.data.repeat??!1,angle:e.data.angle});const o=e.data.gradients.map(n=>de(n)),c=!e.data.shadows||E.value==0?"":e.data.shadows.slice(0,E.value==2?1:void 0).map(n=>ue(n)).join(" "),d=`.seventv-paint[data-seventv-paint-id="${e.id}"]`,f=`${d} {
color: ${e.data.color?g(e.data.color):"inherit"};
background-image: ${o.map(n=>n[0]).join(", ")};
background-position: ${o.map(n=>n[1]).join(", ")};
background-size: ${o.map(n=>n[2]).join(", ")};
background-repeat: ${o.map(n=>n[3]).join(", ")};
filter: ${c||"inherit"};
${e.data.text?`
font-weight: ${e.data.text.weight?e.data.text.weight*100:"inherit"};
-webkit-text-stroke-width: ${e.data.text.stroke?`${e.data.text.stroke.width}px`:"inherit"};
-webkit-text-stroke-color: ${e.data.text.stroke?g(e.data.text.stroke.color):"inherit"};
text-shadow: ${((a=e.data.text.shadows)==null?void 0:a.map(n=>`${n.x_offset}px ${n.y_offset}px ${n.radius}px ${g(n.color)}`).join(", "))??"unset"};
text-transform: ${e.data.text.transform??"unset"};
`:""}
}
`;let r=-1;for(let n=0;n<s.cssRules.length;n++){const u=s.cssRules[n];if(u instanceof CSSStyleRule&&u.selectorText===d){r=n;break}}t||(r>=0?(s.deleteRule(r),s.insertRule(f,r)):s.insertRule(f,s.cssRules.length))}function de(e){const t=["","","",""],s=[];switch(e.function){case"LINEAR_GRADIENT":s.push(`${e.angle??0}deg`);break;case"RADIAL_GRADIENT":s.push(e.shape??"circle");break;case"URL":s.push(e.image_url??"");break}let o="";if(e.function!=="URL"){o=e.repeat?"repeating-":"";for(const c of e.stops){const d=g(c.color);s.push(`${d} ${c.at*100}%`)}}return t[0]=`${o}${e.function.toLowerCase().replace("_","-")}(${s.join(", ")})`,t[1]=e.at&&e.at.length===2?`${e.at[0]*100}% ${e.at[1]*100}%`:"",t[2]=e.size&&e.size.length===2?`${e.size[0]*100}% ${e.size[1]*100}%`:"",t[3]=e.canvas_repeat??"unset",t}function ue(e){return`drop-shadow(${e.x_offset}px ${e.y_offset}px ${e.radius}px ${g(e.color)})`}export{he as D,pe as H,ie as S,g as a,ue as b,de as c,we as d,be as g,ge as n,A as u};
