import{y as P,p as F,o as V,l as G,u as j,z as K,q as Y,d as $}from"./seventv.GearsIcon.3.1.9.js";import{e as U,r as k,a as H,ag as q,x as f,l as b,F as v,E as R,B as T,m as I,G as z,q as X,u as d,Y as J,D as B,f as Q,aw as W,_ as Z,i as ee,ap as te}from"./seventv.index.3.1.9.js";import{R as oe,u as L}from"./seventv.ReactHooks.3.1.9.js";import{d as se}from"./seventv.useModule.3.1.9.js";import{b as ne,d as re}from"./seventv.Transform.3.1.9.js";import{C as ae,M as y}from"./seventv.ChatMessage.3.1.9.js";import{u as ce,a as ie}from"./seventv.useChatEmotes.3.1.9.js";import{u as le,U as me}from"./seventv.UserTag.3.1.9.js";import{_ as pe}from"./seventv.ChatData.vue_vue_type_script_setup_true_lang.3.1.9.js";import{i as ue}from"./seventv.index.3.1.94.js";const de={class:"seventv-chat-vod-message-wrapper"},he={class:"seventv-chat-vod-message-timestamp"},ge=U({__name:"ChatVod",props:{list:{},controller:{}},setup(w){const i=w,h=ce(void 0,!0),g=ie(h),a=le(h),C=k([]);P(i.controller.component,"props",{value(e){var n,l;const{owner:o}=e.data.video??{},s=e.data.badges;let t=null;if(o&&(h.setCurrentChannel({id:o.id,username:o.login,displayName:o.login,active:!0}),t=o.broadcastBadges),e.data.badges&&!((n=a.twitchBadgeSets)!=null&&n.globalsBySet)&&!((l=a.twitchBadgeSets)!=null&&l.channelsBySet)){a.twitchBadgeSets={globalsBySet:new Map,channelsBySet:new Map,count:0};for(const m of[...s,...t??[]]){let p=a.twitchBadgeSets.globalsBySet.get(m.setID);p||(p=new Map,a.twitchBadgeSets.globalsBySet.set(m.setID,p),a.twitchBadgeSets.count++),p.set(m.version,m)}}e.canCurrentUserBan||e.canCurrentUserDelete?(h.actor.roles.add("MODERATOR"),a.showModerationIcons=!0):h.actor.roles.delete("MODERATOR"),a.showTimestamps=!1}}),F(i.list.component,"render",function(e){const o=e==null?void 0:e.apply(this);let t=o.props.children,n=0;for(;!(n++>25);)if(Array.isArray(t)?t=t[0]:t&&(t=t.props.children),t&&!Array.isArray(t)&&t.type==="ul"){t.props.children=c(t.props.children);break}return o}),H(C.value,()=>{!i.list.component||typeof i.list.component.componentDidUpdate!="function"||i.list.component.componentDidUpdate(i.list.component.props,i.list.component.state)});function D(e){return e&&e.badgeSets&&e.canCurrentUserBan!==void 0&&e.canCurrentUserDelete!==void 0&&e.messageContext&&e.messageContext.author&&e.messageContext.comment&&e.messageContext.lastUpdated}function c(e){var s,t;const o=[];C.value.length=0;for(let n=0;n<e.length;n++){const l=e[n];if(!l)continue;const m=l.props;if(!m)continue;const p=m.children;if(!p)continue;const E=(t=(s=p.props)==null?void 0:s.children)==null?void 0:t.props;if(!D(E))continue;const _=S(E);l.props.children=_.element,o[n]=l,C.value[n]={current:Q(_.element.ref),msg:_.msg,timestamp:_.timestamp}}return o}function S(e){var _,x,M,A;const o=k({current:null}),s=e.messageContext.comment,t=new ae(e.messageContext.comment.id);if(e.messageContext.author){const u=e.messageContext.author.name!==e.messageContext.author.displayName.toLowerCase();t.setAuthor({id:e.messageContext.author.id,username:e.messageContext.author.name??"",displayName:e.messageContext.author.displayName??"",color:s.message.userColor,intl:u}),t.badges=s.userBadges}for(const u of s.message.tokens)switch(u.type){case y.EMOTE:{const r=u.content;if(!r.alt)continue;const N={id:r.emoteID??"",name:r.alt,flags:0,provider:"PLATFORM",isTwitchCheer:{amount:r.cheerAmount,color:r.cheerColor},data:r.cheerAmount?ne({alt:r.alt,cheerAmount:r.cheerAmount,cheerColor:r.cheerColor,images:r.images}):re({id:r.emoteID,token:r.alt})},O=r.alt+(r.cheerAmount??"");t.nativeEmotes[O]=N,r.cheerAmount&&(t.nativeEmotes[O.toLowerCase()]=N),t.body+=r.alt;break}case y.MENTION:t.body+=`@${u.content.recipient}`;break;case y.TEXT:case y.CURRENTUSERHIGHLIGHT:t.body+=u.content;break;case y.LINK:case y.CLIPLINK:case y.VIDEOLINK:t.body+=u.content.url;break}const n=ue({start:0,end:s.contentOffset*1e3}),l=n.days?(_=n.days)==null?void 0:_.toString().padStart(2,"0"):"",m=n.hours?(x=n.hours)==null?void 0:x.toString().padStart(2,"0"):l?"00":"",p=((M=n.minutes)==null?void 0:M.toString().padStart(2,"0"))??"00",E=((A=n.seconds)==null?void 0:A.toString().padStart(2,"0"))??"00";return{element:{[W]:oe,key:null,ref:o.value,type:"div",props:{className:"seventv-chat-vod-message-patched"}},msg:t,timestamp:[l,m,p,E].filter(u=>u).join(":")}}return q(()=>{V(i.controller.component,"props"),V(i.list.component,"render"),G.debug("<Chat/Vod> Unmounted")}),(e,o)=>(f(),b(v,null,[(f(!0),b(v,null,R(C.value,s=>(f(),b(v,{key:s.msg.id},[s&&s.current.current?(f(),T(J,{key:0,to:s.current.current},[I("div",de,[I("span",he,z(s.timestamp),1),X(me,{msg:s.msg,emotes:d(g).active},null,8,["msg","emotes"])])],8,["to"])):B("",!0)],64))),128)),d(h).loaded?(f(),T(pe,{key:0})):B("",!0)],64))}}),fe=Z(ge,[["__scopeId","data-v-4e1e51f0"]]),Ce=[$("chat.vods","TOGGLE",{label:"VOD Support",path:["Chat","VODs"],hint:"Enables 7TV rendering in the chat replay of VODs",defaultValue:!0})],_e=U({__name:"ChatVodModule",setup(w){se("chat-vod",{name:"Chat VOD",depends_on:[]});const i=j("chat.vods"),h=ee(te)??k(""),g=L({parentSelector:".video-chat",maxDepth:20,predicate:c=>c.props&&c.props.children&&c.props.onScrollBottom}),a=L({parentSelector:".chat-shell",maxDepth:20,predicate:c=>c.props&&c.props.comments&&typeof c.props.currentVideoTime=="number"},{trackRoot:!0}),C=k(!1),D=K(C,100);return H(()=>[a.instances,g.instances],([c,S])=>{C.value=c.length===S.length},{immediate:!0}),Y(h,()=>{a.instances.length&&g.instances.length||(a.retry(),g.retry())},{debounce:1e3}),(c,S)=>(f(!0),b(v,null,R(d(g).instances,(e,o)=>(f(),b(v,{key:o},[d(D)&&d(i)&&d(g).instances[o]&&d(a).instances[o]?(f(),T(fe,{key:0,list:d(g).instances[o],controller:d(a).instances[o]},null,8,["list","controller"])):B("",!0)],64))),128))}}),xe=Object.freeze(Object.defineProperty({__proto__:null,config:Ce,default:_e},Symbol.toStringTag,{value:"Module"}));export{xe as _};
